{
  "hash": "b4a22e962ed4046c03b4ee4eda976fca",
  "result": {
    "markdown": "---\ntitle: \"Predicting CAFO presence in California based on poverty rates\"\ndescription: \"Analyzing the relationship between poverty rates and CAFO presence.\"\nauthor: \n  - name: Alex Reed\ndate: 2022-12-03\ncategories: [R, Statistical Analysis, Binary Logistic Regression]\ncitation: \n  url: https://reedalexandria.github.io/2022-12-03-cafo-presence\nimage: cows.png\ndraft: false\nformat:\n  html:\n    code-fold: true\n    code-summary: \"show the code\"\n    #code-overflow: wrap\npage-layout: article\nbase_url: https://reedalexandria.github.io\n#title-block-banner-color: \"#aec3b0\"\n---\n\n\n## Question\n\nDo poverty rates (as measured by the percent of the population living below two times the federal poverty level) impact the probability of Concentrated Animal Feeding Operation (CAFO) presence in California?\n\n## Introduction\n\nThe animal agriculture industry comprises hundreds of thousands of individual animal feeding operations (AFOs). These are facilities that raise animals in confinement. CAFOs are a subset of AFOs distinguished by their large size, number of animals, or their designation as significant polluters of surface waters.[^1] Animal feeding facilities in this analysis will be described as CAFOs.\n\n[^1]: https://www.nrdc.org/sites/default/files/cafos-dont-know-hurting-us-report.pdf\n\nCAFOs pollute water sources, contaminate air, generate and spread dangerous pathogens, and exacerbate climate change. As a result, CAFOs cause serious, well-documented harm to humans, wildlife, and the environment. The burdens of CAFO pollution fall disproportionately on communities of color, low-income communities, and under-resourced rural communities.[^2]\n\n[^2]: https://earthjustice.org/sites/default/files/files/cafopresumptionpetitionfinal_oct2022.pdf\n\nAlthough CAFOs are found within all regions of California, high densities occur in the Central Valley. The highest number of CAFO facilities were ranked in the 91-100 and 81-90 percentiles according to the CalEnviroScreen (one of my data sources), especially in relation to poor air and water quality metrics.[^3] There is evidence linking poverty in agricultural regions due to lack of economic diversity, low-paying agricultural jobs, and unhealthy working environments.\n\n[^3]: Alford, Jennifer B. and Perez, Jocelyn, \"Geospatial Applications for Identifying Concentrated Animal Feeding Operations (CAFOs) and Impaired Streams in California\" (2019). Geography and Environmental Studies Faculty Publications.\n\nMy analysis will investigate if poverty rates are a predictor of CAFO presence in California.\n\n## Data\n\n### [Data Source]{.underline}\n\n#### 1. CalEnviroScreen 4.0\n\nI used CalEnviroScreen 4.0 data developed by the California Office of Environmental Health Hazard Assessment (OEHHA). CalEnviroScreen 4.0 was released in October 2021. CalEnviroScreen 4.0 uses environmental, health, and socioeconomic information to produce scores for every census tract in California. The data set includes columns of environmental pollution and population indicators by census tract. This data comes in publicly available .xlsx, .shp, and .gdb formats. I downloaded the .xlsx format.\n\n[**Poverty Indicator Data**]{.underline}\n\nFor this analysis, I focused on the poverty indicator. Information on poverty is collected annually in the US Census Bureau's American Community Survey (ACS). The poverty indicator is defined as the percent of the population living below two times the federal poverty level. The poverty percent per census tract was calculated by individuals living below 200% the poverty level per census tract divided by total individuals living below 200% of the poverty level. The poverty percent was calculated using a 5-year estimate to provide more reliable estimates for geographic areas with small population sizes. The most recent results available at the census tract scale are the 5-year estimates for 2015-2019. Standard error was used to evaluate the reliability of the calculated poverty rate estimates. Census tracts with unreliable estimates received no score for poverty (NA).[^4]\n\n[^4]: NPDES Permit Writers' Manual for CAFOs. (n.d.). 673. (https://www.epa.gov/sites/default/files/2015-10/documents/cafo_permitmanual_entire.pdf)\n\n::: column-margin\n![](poverty.png)\n:::\n\n#### 2. CIWQS Database\n\n[**CAFO Data**]{.underline}\n\nThe Clean Water Act (CWA) requires the U.S. Environmental Protection Agency (USEPA) to regulate CAFOs.[^5] CAFOs are regulated under the National Pollutant Discharge Elimination System (NPDES) permitting program. The California Integrated Water Quality System (CIWQS) is a database used by the State and Regional Water Quality Control Boards to track information about places of environmental interest, manage NPDES permits and other orders, track inspections, and manage violations and enforcement activities.[^6] I was able to generate a Regulated Facility Report of active NPDES permits that fall under the Animal Feeding Facility type. These permits were exported to excel. The data set includes columns with the facility address, facility name, number of animals at the facility (CAFO population), number of violations, among other information. For this analysis, I utilized the facility addresses to determine how many CAFOs were located within each zip code.\n\n[^5]: https://www.nrdc.org/sites/default/files/cafos-dont-know-hurting-us-report.pdf\n\n[^6]: California Integrated Water Quality System Project (CIWQS) \\| California State Water Resources Control Board. (n.d.). Retrieved December 5, 2022, from https://www.waterboards.ca.gov/water_issues/programs/ciwqs/\n\n::: column-margin\n![](cafos.png)\n:::\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(leaflet)\nlibrary(janitor)\nlibrary(readxl)\nlibrary(here)\nlibrary(sf)\n#creating the figure in the column \ncafo_df2<- read_xlsx(here(\"/Users/alexreed/Documents/MEDS/Courses/EDS_222/final_project/EDS222_Final/data/Regulated_Facility_Report_Detail.xlsx\")) |>\n  clean_names()\n\ncafos_plot <- cafo_df2 |>\n  st_as_sf(coords = c(\"longitude\", \"latitude\"), crs = 4326)\n\ncafos_plot |>\nleaflet() |>\naddProviderTiles(providers$Esri.WorldTopoMap, group = \"World Imagery\") |>\naddProviderTiles(providers$Stamen.TonerLite, group = \"Toner Lite\") |>\naddLayersControl(baseGroups = c(\"Esri.WorldTopoMap\", \"Toner Lite\")) |>\n  addCircles()\n```\n:::\n\n\n### [Data Download and Basic Visualizations]{.underline}\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#load packages\nlibrary(tidyverse)\nlibrary(readr)\nlibrary(here)\nlibrary(janitor)\nlibrary(ggplot2)\nlibrary(modelr)\nlibrary(broom)\nlibrary(readxl)\nlibrary(sjPlot)\n\n#read in CalEnviro data and subset poverty data\ncal_enviro <- read_xlsx(here(\"/Users/alexreed/Documents/MEDS/Courses/EDS_222/final_project/EDS222_Final/data/calenviroscreen40resultsdatadictionary_F_2021.xlsx\")) |>\n  clean_names()\n\ncal_enviro$zip <- as.character(cal_enviro$zip)\n\n#poverty subset\ncal_enviro_poverty <- cal_enviro |>\n  select(\"california_county\", \"zip\", \"poverty\") |>\n  group_by(zip) |>\n  summarise(avg_poverty = mean(poverty, na.rm = T)) |>\n  drop_na(avg_poverty)\ncal_enviro_poverty$zip <- as.character(cal_enviro_poverty$zip)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n#poverty histogram\npoverty_hist <- ggplot(cal_enviro_poverty, aes(x = avg_poverty)) +\n  geom_histogram(fill = \"light gray\") +\n  labs(x = \"Average poverty percent\",\n       y = \"Count\",\n       title = \"Distribution of average poverty percent per zip code\") +\n  theme_light() +\n  theme(panel.grid = element_blank(),\n        plot.title = element_text(size = 12))\npoverty_hist\n```\n\n::: {.cell-output-display}\n![Fig 1. Average poverty rates in California were not normally distributed. The average mean percent of the population living below two times the federal property level per zip code is 30.86%.](index_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n#read in cafo data, clean, and select columns of interest \n#create new column that sums the number of CAFOs per zip code\ncafo_df<- read_xlsx(here(\"/Users/alexreed/Documents/MEDS/Courses/EDS_222/final_project/EDS222_Final/data/Regulated_Facility_Report_Detail.xlsx\")) |>\n  clean_names() |>\n  separate(col = facility_address, c(\"address\", \"city\", \"CA_zipcode\"), \", \") |>\n  separate(col = CA_zipcode, c(\"CA\", \"zip\"), \" \") |>\n  drop_na(zip) |>\n  select(\"facility_name\", \"zip\") |>\n  mutate(count = 1) |>\n  group_by(zip) |>\n  summarise(count = sum(count))\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n#CAFO histogram\ncafo_hist <- ggplot(cafo_df, aes(x = count)) +\n  geom_histogram(fill = \"light gray\") +\n  labs(x = \"Number of CAFOs\",\n       y = \"Count\",\n       title = \"Distribution of CAFOs per zip code\") +\n  theme_light() +\n  theme(panel.grid = element_blank(),\n        plot.title = element_text(size = 12))\ncafo_hist\n```\n\n::: {.cell-output-display}\n![Fig 2. The number of CAFOs in California were not normally distributed. The mean number of CAFOs per zip code was 9.7.](index_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n\n\nI then joined the data sets and created a binary variable. I created a column based on CAFO presence (`cafo_presence`). If there was a 0 in the `count` column the `cafo_presence` column received a `not present` variable and if there were one or more CAFOs it received a `present` variable. I created an additional column, `cafo_presence_numeric` for the numeric equivalence.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#join the poverty and CAFO data sets by zip code. Make a binary variable.\njoined_poverty <- left_join(cal_enviro_poverty, cafo_df, by = \"zip\") \njoined_poverty[\"count\"][is.na(joined_poverty[\"count\"])] <- 0 #NA = zip codes without CAFOs, converting to 0 instead of NA\njoined_poverty <- mutate(joined_poverty, cafo_presence = ifelse(count==0, \"not present\", \"present\")) |>\n  mutate(joined_poverty, cafo_presence_numeric = ifelse(cafo_presence==\"not present\", 0, 1))\n#creating two new rows: cafo_presence = 'present' or 'not present', and cafo_presence_numeric = 1 or 0\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\njoined_plot <- \n  ggplot(data = joined_poverty, aes(x = avg_poverty, \n                                        y = cafo_presence, \n                                        color = cafo_presence)) +\n  geom_point(position=position_jitter(height=0.05, width=0), \n                 alpha = 0.8) +\n      labs(x = \"Average poverty percent\", \n           y = \"CAFO Presence\")\njoined_plot + scale_color_manual(values = c(\"#aec3b0\", \"#124559\")) +\n  theme_minimal()\n```\n\n::: {.cell-output-display}\n![Fig 3. Visualizing a binary response](index_files/figure-html/unnamed-chunk-7-1.png){width=672}\n:::\n:::\n\n\n### [Data Limitations]{.underline}\n\n-   I was unable to locate CAFO location data per census tract. Therefore, I averaged the poverty data per zip code and joined the two data sets by zip code. Multiple census tracts are within one zip code; thus, the averaging of the poverty rate per zip code could increase or decrease the poverty percent of an area.\n-   There are 1,736 zip codes in California, but the poverty data only included 1,345 zip codes.\n-   Out of 8,035 observations, 75 observations had no poverty data (NA). I removed the NAs.\n-   The EPA admits that numerous CAFOs currently discharge water pollution without NPDES permits.[^7] Thus, there may be CAFOs unaccounted for in this analyses.\n\n[^7]: NPDES Permit Writers' Manual for CAFOs. (n.d.). 673. (https://www.epa.gov/sites/default/files/2015-10/documents/cafo_permitmanual_entire.pdf)\n\n## Methods\n\n#### [**Hypothesis**]{.underline}\n\nThe null hypothesis (H0): There is no relationship between poverty percent and CAFO presence in California.\n\nThe alternative hypothesis (HA): There is a relationship between poverty percent and CAFO presence in California.\n\n#### [**Logistic Regression**]{.underline}\n\nThere are limitations to a simple linear regression with binary outcomes; thus, I used a generalized linear model (GLM) to run a logistic regression, as this is useful for modeling a binary response variable.\n\nI used the GLM to model the probability of a binary event (presence of CAFOs) for varying poverty rates in California.\n\n\n$$\\operatorname{logit}(p)=\\log \\left(\\frac{p}{1-p}\\right)=\\beta_0+\\beta_1  (poverty)  +\\varepsilon $$\n\n\n## Results\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#fit model\nmod_poverty <- glm(cafo_presence_numeric~avg_poverty, data = joined_poverty, family = 'binomial')\nsummary(mod_poverty)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n#model output table format\ntab_model(mod_poverty,\n          transform = NULL,\n          pred.labels = c(\"Intercept\", \"Average Poverty (%)\"),\n          dv.labels = c(\"log CAFO Presence Probability\"),\n          show.p = TRUE,\n          p.style = c(\"numeric_stars\"),\n          p.threshold = c(0.10, 0.05, 0.01),\n          string.p = \"P-value\",\n          show.r2 = FALSE,\n          title = \"Tbl 1. Logistic Regression Model Results for Average Poverty Percent\",\n          digits = 3)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table style=\"border-collapse:collapse; border:none;\">\n<caption style=\"font-weight: bold; text-align:left;\">Tbl 1. Logistic Regression Model Results for Average Poverty Percent</caption>\n<tr>\n<th style=\"border-top: double; text-align:center; font-style:normal; font-weight:bold; padding:0.2cm;  text-align:left; \">&nbsp;</th>\n<th colspan=\"3\" style=\"border-top: double; text-align:center; font-style:normal; font-weight:bold; padding:0.2cm; \">log CAFO Presence Probability</th>\n</tr>\n<tr>\n<td style=\" text-align:center; border-bottom:1px solid; font-style:italic; font-weight:normal;  text-align:left; \">Predictors</td>\n<td style=\" text-align:center; border-bottom:1px solid; font-style:italic; font-weight:normal;  \">Log-Odds</td>\n<td style=\" text-align:center; border-bottom:1px solid; font-style:italic; font-weight:normal;  \">CI</td>\n<td style=\" text-align:center; border-bottom:1px solid; font-style:italic; font-weight:normal;  \">P-value</td>\n</tr>\n<tr>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; \">Intercept</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \">&#45;3.383 <sup>***</sup></td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \">&#45;3.819&nbsp;&ndash;&nbsp;-2.969</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \"><strong>&lt;0.001</strong></td>\n</tr>\n<tr>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; \">Average Poverty (%)</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \">0.042 <sup>***</sup></td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \">0.032&nbsp;&ndash;&nbsp;0.052</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \"><strong>&lt;0.001</strong></td>\n</tr>\n<tr>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; padding-top:0.1cm; padding-bottom:0.1cm; border-top:1px solid;\">Observations</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; padding-top:0.1cm; padding-bottom:0.1cm; text-align:left; border-top:1px solid;\" colspan=\"3\">1345</td>\n</tr>\n<tr>\n<td colspan=\"4\" style=\"font-style:italic; border-top:double black; text-align:right;\">* p&lt;0.1&nbsp;&nbsp;&nbsp;** p&lt;0.05&nbsp;&nbsp;&nbsp;*** p&lt;0.01</td>\n</tr>\n\n</table>\n\n`````\n:::\n:::\n\n\nThe model tells us that:\n\n\n$$\n\\operatorname{logit}(\\hat p)=\\log \\left(\\frac{\\hat p}{1-\\hat p}\\right)=-3.38+0.0419 x\n$$\n\n\nFor every one unit increase in the average poverty percent, the log odds of a CAFO being present increases by 0.0419.\n\nSince the p-value = 1.09e-15 \\< 0.05, I can reject the null that there is no relationship between poverty percent and CAFO presence in California.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#visualizing logistic regression\njoined_plot2 <- \n  ggplot(data = joined_poverty, aes(x = avg_poverty, \n                                    y = cafo_presence_numeric,\n                                    color = cafo_presence)) + \n  geom_point(position=position_jitter(height=0.05, width=0), \n             alpha = 0.8) +\n  labs(x = \"Average poverty percent\", \n       y = \"CAFO Presence\")\njoined_plot2 + scale_color_manual(values = c(\"#aec3b0\", \"#124559\")) +\n  geom_smooth(method = \"glm\", se = FALSE, color = \"#598392\", \n              method.args = list(family = \"binomial\")) +\n  theme_minimal()\n```\n\n::: {.cell-output-display}\n![Fig 4. CAFO presence by average poverty percent per zip code. As the average poverty percent increases, the probability of CAFO presence increases.](index_files/figure-html/unnamed-chunk-10-1.png){width=672}\n:::\n:::\n\n\n#### [**Probability scale and plot**]{.underline}\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmod_plus <- mod_poverty |>\n  augment(type.predict = \"response\") |>\n  mutate(y_hat = .fitted)\n\nggplot(mod_plus, aes(x = avg_poverty, y = y_hat)) + \n  geom_point(color = \"#124559\") + \n  geom_line(color = \"#598392\") + \n  scale_y_continuous(\"Probability of CAFO Presence\", limits = c(0, 1)) +\n  labs(x = \"Average poverty percent\") +\n  theme_minimal()\n```\n\n::: {.cell-output-display}\n![Fig 5: Probability of CAFO presence by poverty percent](index_files/figure-html/unnamed-chunk-11-1.png){width=672}\n:::\n:::\n\n\n#### [**Odds scale and plot**]{.underline}\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmod_plus <- mod_plus |>\n  mutate(odds_hat = y_hat / (1 - y_hat))\n\nggplot(mod_plus, aes(x = avg_poverty, y = odds_hat)) + \n  geom_point(color = \"#124559\") + \n  geom_line(color = \"#598392\") + \n  scale_y_continuous(\"Odds of CAFO Presence\") +\n  labs(x = \"Average poverty percent\") +\n  theme_minimal()\n```\n\n::: {.cell-output-display}\n![Fig 6. Odds of CAFO presence by poverty percent.](index_files/figure-html/unnamed-chunk-12-1.png){width=672}\n:::\n:::\n\n\nWhen I compute the odd ratio, the odds of CAFO presence increase exponentially as poverty percent increase. The odds of CAFO presence increase more with higher poverty rates.\n\n## Conclusion\n\nThe results indicate that there is a statistically significant relationship between poverty percent and the presence of CAFOs in California. As the average poverty percent increases, the probability of CAFO presence increases. As previously mentioned, CAFOs are point sources of pollution. Therefore, my analysis provides evidence that CAFO pollution is disproportionately affecting people with high poverty rates in California, which raises environmental justice issues.\n\n## Future Research\n\nThis analysis was a simple univariate logistic regression. Future analyses could look at multiple variables, but instead of predicting CAFO presence, determine if CAFO presence or the number of CAFOs present in a region is a predictor of environmental pollution variables such as poor water or air quality. Other interesting objectives could be to spatially analyze the distribution of CAFOs and proximity to impaired body of waters or areas with air pollution. The end goal would be to provide evidence to inform policy for stricter CAFO regulations and protections for vulnerable communities.\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}